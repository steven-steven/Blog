<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Breakdown - Maze Generator (by Mike Bostock)</title>
    <link rel="stylesheet" href="/assets/tailwind-411f91dd5b89fb0c5835c0d0f1189f0def25c96cd270c454ec884aba7c991825.css" media="screen" />
    <script src="/assets/build/application-4230f8bd593d59f5f3586a39eb8353a548c37479bd50792836be84edda12f04c.js"></script>
  </head>
  <body class="bg-gray-100 dark:bg-slate-900 text-slate-900 dark:text-slate-300 text-sm md:text-base">
    <div class="flex flex-col md:flex-row items-center gap-5 justify-between mx-32 mt-10 md:mt-20">
  <a class="text-3xl font-serif font-light" href="/">Steven</a>
  <nav class="flex gap-x-6 items-center">
    <button data-controller="dark-toggle" data-action="dark-toggle#toggle dblclick->dark-toggle#resetSystemMode" type="button" class="inline-block align-middle nav-link">
  <svg data-dark-toggle-target="dark" class="hidden w-6 h-6 text-slate-700" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
  <svg data-dark-toggle-target="light" class="w-6 h-6 text-slate-200" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
</button>
      <a href="/blog">Blog</a>
      <a href="/works">Works</a>
  </nav>
</div>
    
  <div class="max-w-[46rem] md:mx-auto flex flex-col gap-y-10 md:gap-y-20 px-6 md:px-11 leading-relaxed font-serif">
    <div>
      
  <header class="pt-12 md:pt-16">
    <h1 class="text-2xl md:text-3xl font-bold">Code Breakdown - Maze Generator (by Mike Bostock)</h1>
      <p class="opacity-70">Sunday,  October 20 2019<p>
  </header>
  <main class="prose dark:prose-invert max-w-none mt-6 text-inherit text-base md:text-lg break-words prose-code:before:hidden prose-code:after:hidden prose-code:p-1 prose-code:rounded-md prose-code:font-medium prose-code:bg-gray-300 dark:prose-code:bg-slate-700">
    <script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>

<p>&lt;script
    type=&ldquo;text/javascript&rdquo;
    src=&ldquo;code-brakedown-maze-generator/mazeGenerators.js&rdquo;</p>

<blockquote>
<p></script></p>
</blockquote>

<p>Last week I came across &lsquo;<a href="https://bost.ocks.org/mike/algorithms/" target="_blank">Visualizing Algorithms</a>&rsquo;, an article by Mike Bostock (creator of D3.js). He wrote about visualizing different algorithms for sampling, shuffling, sorting, and maze generation. Aside from all technical complexities and use cases of these algorithms, I was equally curious about how Mike was able to create those stunning visualizations.</p>

<blockquote>
<p>&ldquo;Visualization leverages the human visual system to augment human intellect&rdquo; - Mike Bostock</p>
</blockquote>

<p>After skimming the article, I grabbed myself a :banana: and I sneaked into the code. Surprisingly it was shorter than I expected. I didn&rsquo;t know a lot about D3 but the short code encourages me that it wasn&rsquo;t going to be a huge learning curve, and probably not as complex as I thought it&rsquo;d be.
In this post I will breakdown one of Mike&rsquo;s maze generator visuals - &ldquo;Randomized Depth-First&rdquo;. Here is a link to his <a href="https://bl.ocks.org/mbostock/1ef3b1fb9eb35ca8ffff" target="_blank">code and his pleasing visualization</a>.</p>

<p>:construction: Please reload this page if you can&rsquo;t see the maze (or change browser). You can click it over &amp; over again.</p>

<center>
    <Canvas id="originalMaze"></Canvas>
</center>

<p>I enjoyed reading this algorithm. It&rsquo;s like analyzing poetry; takes a while until it clicks. And like any poetry, there&rsquo;s a lot of freedom in expressing the work, so it was also interesting to see the implementation approach chosen by the writer. Anyhow that&rsquo;s my motivation; and although this post is long, I hope you would enjoy it.</p>

<p>Side note: Along with this post, I have snippets of the code; but please be reminded that all of it belong to the original <del>poet</del> programmer.</p>

<h2 id="table-of-contents">Table of Contents</h2>

<ul>
<li>  <a href="#goals" target="_blank">Goals</a></li>
<li>  <a href="#d3-svg-and-canvas" target="_blank">D3, SVG, and Canvas</a></li>
<li>  <a href="#algorithm" target="_blank">Algorithm</a></li>
<li>  <a href="#core-components" target="_blank">Core Components</a>

<ul>
<li>  <a href="#cellsize-and-cellspacing" target="_blank">cellSize and cellSpacing</a></li>
<li>  <a href="#direction" target="_blank">direction</a></li>
<li>  <a href="#cells" target="_blank">cells[]</a></li>
<li>  <a href="#frontier" target="_blank">frontier[]</a></li>
</ul></li>
<li>  <a href="#getting-into-the-code" target="_blank">Getting into the code</a>

<ul>
<li>  <a href="#setting-up-the-canvas" target="_blank">Setting up the canvas</a></li>
<li>  <a href="#starting-point-for-traversal" target="_blank">Starting point for traversal</a></li>
<li>  <a href="#traversee" target="_blank">Traversee!</a></li>
<li>  <a href="#breaking-down-explorefrontier" target="_blank">Breaking down exploreFrontier()</a></li>
</ul></li>
<li>  <a href="#thoughts" target="_blank">Thoughts</a></li>
<li>  <a href="#what-i-learned" target="_blank">What I learned</a></li>
<li>  <a href="#difficulties-with-client-side-js" target="_blank">Diffculties with Client-side JS</a></li>
</ul>

<h2 id="goals">Goals</h2>

<ul>
<li>  Introduce myself to D3.js</li>
<li>  Learn one maze generator algorithm</li>
</ul>

<h2 id="d3-svg-and-canvas">D3, SVG, and Canvas</h2>

<p>I went over a great <a href="https://www.youtube.com/playlist?list=PL6il2r9i3BqH9PmbOf5wA5E1wOG3FT22p" target="_blank">D3 tutorial series by Vienno</a> which covers how to load and bind data, enter-exit-update selections, path generators, layout generators, transition, scales, etc. That I thought was enough to get me started with the code.</p>

<p>Then I realize.. the code didn&rsquo;t use D3&rsquo;s SVG, but HTML5 Canvas. I asked Google and it turns out, the browser can vomit :dizzy_face: if it tries to handle too much SVG under its DOM (:book: â€‹&quot;<a href="https://www.freecodecamp.org/news/d3-and-canvas-in-3-steps-8505c8b27444/" target="_blank">D3 and Canvas in 3 steps</a>&ldquo; by Iars verspohl). So for animations like this, Canvas is more preferable. When using Canvas, the DOM would only see the canvas, and any (virtual DOM) elements added into the canvas will be stored only in the memory and invisible to the browser; therefore the browser won&rsquo;t be stressed from overwork. We can then use D3 to interact with these virtual elements.</p>

<p>I decided not to dig too deep, so I&rsquo;ll leave it for another time/space.</p>

<h2 id="algorithm">Algorithm</h2>

<p>I won&rsquo;t go in too much depth on the algorithm, but its pretty much depth-first search using a stack. It pops the stack to visit a cell, and push into the stack all the possible paths from that cell. There is at most 4 possible paths from a cell (North, East, West, South). The 2 base (terminating) cases are when a path that goes off the canvas or when the path already has an existing cell.</p>

<p>Overall, the time complexity remains O(n) since every cell is visited exactly once.</p>

<h2 id="core-components">Core Components</h2>

<h3 id="cellsize-and-cellspacing">cellSize and cellSpacing</h3>

<p>One thing that confuses me in the beginning was the structure. I keep forgetting that the cells are separated by spaces. These spaces can be colored either black or white, depending whether there is a path between the two cells.
<img src="https://steven-steven.github.io/Blog/assets/images/blogAssets/code-brakedown-maze-generator/cell_layout.png" width="400" height="400" alt="Maze Cell Layout" style="margin: 1.5rem auto;">
Above is a 7x7 maze cell. The <code>cellSize=12</code> and <code>cellSpacing=8</code>. The cells are always a square, while the spacings are a rectangular block with size cellSize x cellSpacing.</p>

<h3 id="direction">direction</h3>
<pre class="javascript"><span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">N</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">1</span> <span style="color: #fbf1c7">&lt;&lt;</span> <span style="color: #d3869b">0</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">S</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">1</span> <span style="color: #fbf1c7">&lt;&lt;</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">W</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">1</span> <span style="color: #fbf1c7">&lt;&lt;</span> <span style="color: #d3869b">2</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">E</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">1</span> <span style="color: #fbf1c7">&lt;&lt;</span> <span style="color: #d3869b">3</span><span style="color: #fbf1c7">;</span>
</pre>
<p>The directions are labeled as N, W, S, E and each is represented by a bit. N is bit 0, S is bit 1, W is bit 2, and E is bit 3.</p>

<p>Why? now each and every cell only needs to store 4 bits to keep track of all of its connected paths.</p>

<h3 id="cells">cells[]</h3>

<p><code>cells[]</code> is an 1D array of size 49 (for a 7x7 maze) to keep track of each cell. It stores a 4-bit value that marks the 4 paths that it may/may not be currently connected. For example, if bit 0 is 0 it means that the current cell is not connected to its neighbor in the North (recall that direction N represented by bit 0).</p>

<h3 id="frontier">frontier[]</h3>

<p>this is the stack for the DFS. It stores an object <code>{cellIndex, direction}</code></p>

<ul>
<li>  cellIndex is index in the <code>cell[]</code> array for the visited cell</li>
<li>  direction indicates a possible path from that cell. (possible values are N, S, W, E)</li>
</ul>

<h2 id="getting-into-the-code">Getting into the code</h2>

<h3 id="setting-up-the-canvas">Setting up the canvas</h3>
<pre class="javascript"><span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">width</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">150</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">height</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">150</span><span style="color: #fbf1c7">;</span>

<span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">N</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">1</span> <span style="color: #fbf1c7">&lt;&lt;</span> <span style="color: #d3869b">0</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">S</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">1</span> <span style="color: #fbf1c7">&lt;&lt;</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">W</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">1</span> <span style="color: #fbf1c7">&lt;&lt;</span> <span style="color: #d3869b">2</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">E</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">1</span> <span style="color: #fbf1c7">&lt;&lt;</span> <span style="color: #d3869b">3</span><span style="color: #fbf1c7">;</span>

<span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">cellSize</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">12</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">8</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">cellWidth</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">Math</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">floor</span><span style="color: #fbf1c7">((</span><span style="color: #fbf1c7;background-color: #282828">width</span> <span style="color: #fbf1c7">-</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">/</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">cellSize</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">)),</span>
    <span style="color: #fbf1c7;background-color: #282828">cellHeight</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">Math</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">floor</span><span style="color: #fbf1c7">((</span><span style="color: #fbf1c7;background-color: #282828">height</span> <span style="color: #fbf1c7">-</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">/</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">cellSize</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">)),</span>
    <span style="color: #fbf1c7;background-color: #282828">cells</span> <span style="color: #fbf1c7">=</span> <span style="color: #fb4934">new</span> <span style="color: #8ec07c">Array</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">cellWidth</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellHeight</span><span style="color: #fbf1c7">),</span>
    <span style="color: #fbf1c7;background-color: #282828">frontier</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7">[];</span>

<span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">canvas</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">d3</span>
    <span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">select</span><span style="color: #fbf1c7">(</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #b8bb26;font-style: italic">body</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #fbf1c7">)</span>
    <span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">append</span><span style="color: #fbf1c7">(</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #b8bb26;font-style: italic">canvas</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #fbf1c7">)</span>
    <span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">attr</span><span style="color: #fbf1c7">(</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #b8bb26;font-style: italic">width</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #fbf1c7">,</span> <span style="color: #fbf1c7;background-color: #282828">width</span><span style="color: #fbf1c7">)</span>
    <span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">attr</span><span style="color: #fbf1c7">(</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #b8bb26;font-style: italic">height</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #fbf1c7">,</span> <span style="color: #fbf1c7;background-color: #282828">height</span><span style="color: #fbf1c7">);</span>

<span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">context</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">canvas</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">node</span><span style="color: #fbf1c7">().</span><span style="color: #fbf1c7;background-color: #282828">getContext</span><span style="color: #fbf1c7">(</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #b8bb26;font-style: italic">2d</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #fbf1c7">);</span>

<span style="color: #928374;font-style: italic">//translate by [leftover_canvas_space/2].</span>
<span style="color: #928374;font-style: italic">//leftover_canvas_space = [width - TotalCellSize - TotalCellSpacing]</span>
<span style="color: #fbf1c7;background-color: #282828">context</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">translate</span><span style="color: #fbf1c7">(</span>
    <span style="color: #fbf1c7;background-color: #282828">Math</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">round</span><span style="color: #fbf1c7">(</span>
        <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">width</span> <span style="color: #fbf1c7">-</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSize</span> <span style="color: #fbf1c7">-</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">cellWidth</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">/</span> <span style="color: #d3869b">2</span>
    <span style="color: #fbf1c7">),</span>
    <span style="color: #fbf1c7;background-color: #282828">Math</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">round</span><span style="color: #fbf1c7">(</span>
        <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">height</span> <span style="color: #fbf1c7">-</span> <span style="color: #fbf1c7;background-color: #282828">cellHeight</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSize</span> <span style="color: #fbf1c7">-</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">cellHeight</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">/</span> <span style="color: #d3869b">2</span>
    <span style="color: #fbf1c7">)</span>
<span style="color: #fbf1c7">);</span>
</pre>
<p>Here we define <code>width</code> and <code>height</code> of the canvas, the direction values, the <code>cellSize</code> and <code>cellSpacing</code>, the <code>cells[]</code>, and the <code>frontier[]</code> like discussed earlier. <code>cellWidth</code> is the number of columns in the maze while <code>cellHeight</code> is the number of rows (I don&rsquo;t understand why its named that way).</p>

<p>Then it create a <code>&lt;canvas&gt;</code> within the body, and get a reference to the 2d context of the canvas. This context is your tools/paint-brush you use to draw things onto the canvas.
We then translate/move the context to the middle of the canvas. Translating the context simply moves the coordinate system so now (0,0) is shifted by a few pixels.</p>

<p>Note that the number of spacing is one more than the number of cells in a row or column. For example, picture a 7x7 maze. The number of cell rows is 7 while the number of spacing rows is 8.</p>

<h3 id="starting-point-for-traversal">Starting point for traversal</h3>

<p>Like any DFS, push the starting element onto the stack.</p>
<pre class="javascript"><span style="color: #fbf1c7;background-color: #282828">context</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">fillStyle</span> <span style="color: #fbf1c7">=</span> <span style="color: #b8bb26;font-style: italic">"</span><span style="color: #b8bb26;font-style: italic">white</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #fbf1c7">;</span>

<span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">start</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">cellHeight</span> <span style="color: #fbf1c7">-</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">;</span>
<span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">start</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">0</span><span style="color: #fbf1c7">;</span>
<span style="color: #fbf1c7;background-color: #282828">fillCell</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">start</span><span style="color: #fbf1c7">);</span>
<span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">push</span><span style="color: #fbf1c7">({</span> <span style="color: #b8bb26">index</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">start</span><span style="color: #fbf1c7">,</span> <span style="color: #b8bb26">direction</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">N</span> <span style="color: #fbf1c7">});</span>
<span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">push</span><span style="color: #fbf1c7">({</span> <span style="color: #b8bb26">index</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">start</span><span style="color: #fbf1c7">,</span> <span style="color: #b8bb26">direction</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">E</span> <span style="color: #fbf1c7">});</span>
</pre><pre class="javascript"><span style="color: #fe8019">function</span> <span style="color: #fbf1c7;background-color: #282828">fillCell</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">index</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">{</span>
    <span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">index</span> <span style="color: #fbf1c7">%</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">,</span> <span style="color: #928374;font-style: italic">//column index</span>
        <span style="color: #fbf1c7;background-color: #282828">j</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">index</span> <span style="color: #fbf1c7">/</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">|</span> <span style="color: #d3869b">0</span><span style="color: #fbf1c7">;</span> <span style="color: #928374;font-style: italic">//row index</span>
    <span style="color: #fbf1c7;background-color: #282828">context</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">fillRect</span><span style="color: #fbf1c7">(</span>
        <span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSize</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">j</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSize</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">j</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">cellSize</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">cellSize</span>
    <span style="color: #fbf1c7">);</span>
<span style="color: #fbf1c7">}</span>
</pre>
<p>We define the start index as the first cell in the last row. Then we use <code>fillCell()</code> function to draw a white square for the cell. This function recieves the index of the cell, and draw a rectangle at the specific pixels.
After filling the cell, it push all the possible paths (N and E) onto the <code>frontier[]</code> stack.</p>

<h3 id="traversee">Traversee!</h3>
<pre class="javascript"><span style="color: #fbf1c7;background-color: #282828">d3</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">timer</span><span style="color: #fbf1c7">(</span><span style="color: #fe8019">function</span><span style="color: #fbf1c7">()</span> <span style="color: #fbf1c7">{</span>
    <span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">done</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">k</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">0</span><span style="color: #fbf1c7">;</span>
    <span style="color: #fb4934">while </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7">++</span><span style="color: #fbf1c7;background-color: #282828">k</span> <span style="color: #fbf1c7">&lt;</span> <span style="color: #d3869b">50</span> <span style="color: #fbf1c7">&amp;&amp;</span> <span style="color: #fbf1c7">!</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">done</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">exploreFrontier</span><span style="color: #fbf1c7">()));</span>
    <span style="color: #fb4934">return</span> <span style="color: #fbf1c7;background-color: #282828">done</span><span style="color: #fbf1c7">;</span>
<span style="color: #fbf1c7">});</span>
</pre>
<p><code>exploreFrontier()</code> will do all of our operations at each iteration (visiting a new cell each time). It uses the <a href="https://github.com/d3/d3-timer" target="_blank">D3 timer API</a> to keep doing this repeatedly until it returns true (no more items to pop)</p>
<pre class="javascript"><span style="color: #fe8019">function</span> <span style="color: #fbf1c7;background-color: #282828">exploreFrontier</span><span style="color: #fbf1c7">()</span> <span style="color: #fbf1c7">{</span>
    <span style="color: #fb4934">if </span><span style="color: #fbf1c7">((</span><span style="color: #fbf1c7;background-color: #282828">edge</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">pop</span><span style="color: #fbf1c7">())</span> <span style="color: #fbf1c7">==</span> <span style="color: #d3869b">null</span><span style="color: #fbf1c7">)</span> <span style="color: #fb4934">return</span> <span style="color: #d3869b">true</span><span style="color: #fbf1c7">;</span>

    <span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">edge</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">i0</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">edge</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">index</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">edge</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">direction</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">=</span>
            <span style="color: #fbf1c7;background-color: #282828">i0</span> <span style="color: #fbf1c7">+</span>
            <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">===</span> <span style="color: #fbf1c7;background-color: #282828">N</span> <span style="color: #fbf1c7">?</span> <span style="color: #fbf1c7">-</span><span style="color: #fbf1c7;background-color: #282828">cellWidth</span> <span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">===</span> <span style="color: #fbf1c7;background-color: #282828">S</span> <span style="color: #fbf1c7">?</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span> <span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">===</span> <span style="color: #fbf1c7;background-color: #282828">W</span> <span style="color: #fbf1c7">?</span> <span style="color: #fbf1c7">-</span><span style="color: #d3869b">1</span> <span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7">+</span><span style="color: #d3869b">1</span><span style="color: #fbf1c7">),</span>
        <span style="color: #fbf1c7;background-color: #282828">x0</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">i0</span> <span style="color: #fbf1c7">%</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">y0</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i0</span> <span style="color: #fbf1c7">/</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">|</span> <span style="color: #d3869b">0</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">x1</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">y1</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">d1</span><span style="color: #fbf1c7">,</span> <span style="color: #928374;font-style: italic">//direction of previous block from i1's POV</span>
        <span style="color: #fbf1c7;background-color: #282828">open</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">==</span> <span style="color: #d3869b">null</span><span style="color: #fbf1c7">;</span> <span style="color: #928374;font-style: italic">// opposite not yet part of the maze</span>

    <span style="color: #928374;font-style: italic">//fill i1 according to d0 (this is for the spacing in between)</span>
    <span style="color: #fbf1c7;background-color: #282828">context</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">fillStyle</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">open</span> <span style="color: #fbf1c7">?</span> <span style="color: #b8bb26;font-style: italic">"</span><span style="color: #b8bb26;font-style: italic">white</span><span style="color: #b8bb26;font-style: italic">"</span> <span style="color: #fbf1c7">:</span> <span style="color: #b8bb26;font-style: italic">"</span><span style="color: #b8bb26;font-style: italic">black</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #fbf1c7">;</span>
    <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">===</span> <span style="color: #fbf1c7;background-color: #282828">N</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7;background-color: #282828">fillSouth</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">x1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">x0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">y1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">y0</span> <span style="color: #fbf1c7">-</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">S</span><span style="color: #fbf1c7">);</span>
    <span style="color: #fb4934">else</span> <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">===</span> <span style="color: #fbf1c7;background-color: #282828">S</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7;background-color: #282828">fillSouth</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">x1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">x0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">y1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">y0</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">N</span><span style="color: #fbf1c7">);</span>
    <span style="color: #fb4934">else</span> <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">===</span> <span style="color: #fbf1c7;background-color: #282828">W</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7;background-color: #282828">fillEast</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">x1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">x0</span> <span style="color: #fbf1c7">-</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">y1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">y0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">E</span><span style="color: #fbf1c7">);</span>
    <span style="color: #fb4934">else</span> <span style="color: #fbf1c7;background-color: #282828">fillEast</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">x1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">x0</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">y1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">y0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">W</span><span style="color: #fbf1c7">);</span>

    <span style="color: #928374;font-style: italic">//fill magenta fontier (if open)</span>
    <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">open</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">{</span>
        <span style="color: #fbf1c7;background-color: #282828">fillCell</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">);</span>
        <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i0</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">|=</span> <span style="color: #fbf1c7;background-color: #282828">d0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">|=</span> <span style="color: #fbf1c7;background-color: #282828">d1</span><span style="color: #fbf1c7">);</span> <span style="color: #928374;font-style: italic">//fill cell with direction 1111</span>
        <span style="color: #fbf1c7;background-color: #282828">context</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">fillStyle</span> <span style="color: #fbf1c7">=</span> <span style="color: #b8bb26;font-style: italic">"</span><span style="color: #b8bb26;font-style: italic">magenta</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #fbf1c7">;</span>

        <span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">m</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">0</span><span style="color: #fbf1c7">;</span>
        <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">y1</span> <span style="color: #fbf1c7">&gt;</span> <span style="color: #d3869b">0</span> <span style="color: #fbf1c7">&amp;&amp;</span> <span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">-</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">==</span> <span style="color: #d3869b">null</span><span style="color: #fbf1c7">)</span>
            <span style="color: #fbf1c7;background-color: #282828">fillSouth</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">-</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">),</span>
                <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">push</span><span style="color: #fbf1c7">({</span> <span style="color: #b8bb26">index</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">,</span> <span style="color: #b8bb26">direction</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">N</span> <span style="color: #fbf1c7">}),</span>
                <span style="color: #fbf1c7">++</span><span style="color: #fbf1c7;background-color: #282828">m</span><span style="color: #fbf1c7">;</span>
        <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">y1</span> <span style="color: #fbf1c7">&lt;</span> <span style="color: #fbf1c7;background-color: #282828">cellHeight</span> <span style="color: #fbf1c7">-</span> <span style="color: #d3869b">1</span> <span style="color: #fbf1c7">&amp;&amp;</span> <span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">==</span> <span style="color: #d3869b">null</span><span style="color: #fbf1c7">)</span>
            <span style="color: #fbf1c7;background-color: #282828">fillSouth</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">push</span><span style="color: #fbf1c7">({</span> <span style="color: #b8bb26">index</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">,</span> <span style="color: #b8bb26">direction</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">S</span> <span style="color: #fbf1c7">}),</span> <span style="color: #fbf1c7">++</span><span style="color: #fbf1c7;background-color: #282828">m</span><span style="color: #fbf1c7">;</span>
        <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">x1</span> <span style="color: #fbf1c7">&gt;</span> <span style="color: #d3869b">0</span> <span style="color: #fbf1c7">&amp;&amp;</span> <span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">-</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">==</span> <span style="color: #d3869b">null</span><span style="color: #fbf1c7">)</span>
            <span style="color: #fbf1c7;background-color: #282828">fillEast</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">-</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">push</span><span style="color: #fbf1c7">({</span> <span style="color: #b8bb26">index</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">,</span> <span style="color: #b8bb26">direction</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">W</span> <span style="color: #fbf1c7">}),</span> <span style="color: #fbf1c7">++</span><span style="color: #fbf1c7;background-color: #282828">m</span><span style="color: #fbf1c7">;</span>
        <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">x1</span> <span style="color: #fbf1c7">&lt;</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span> <span style="color: #fbf1c7">-</span> <span style="color: #d3869b">1</span> <span style="color: #fbf1c7">&amp;&amp;</span> <span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">==</span> <span style="color: #d3869b">null</span><span style="color: #fbf1c7">)</span>
            <span style="color: #fbf1c7;background-color: #282828">fillEast</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">push</span><span style="color: #fbf1c7">({</span> <span style="color: #b8bb26">index</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">,</span> <span style="color: #b8bb26">direction</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">E</span> <span style="color: #fbf1c7">}),</span> <span style="color: #fbf1c7">++</span><span style="color: #fbf1c7;background-color: #282828">m</span><span style="color: #fbf1c7">;</span>
        <span style="color: #fbf1c7;background-color: #282828">shuffle</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">,</span> <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">length</span> <span style="color: #fbf1c7">-</span> <span style="color: #fbf1c7;background-color: #282828">m</span><span style="color: #fbf1c7">,</span> <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">length</span><span style="color: #fbf1c7">);</span>
    <span style="color: #fbf1c7">}</span>
<span style="color: #fbf1c7">}</span>

<span style="color: #fe8019">function</span> <span style="color: #fbf1c7;background-color: #282828">fillCell</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">index</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">{</span>
    <span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">index</span> <span style="color: #fbf1c7">%</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">,</span> <span style="color: #928374;font-style: italic">//horizontal index (divide over row size and see what's left)</span>
        <span style="color: #fbf1c7;background-color: #282828">j</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">index</span> <span style="color: #fbf1c7">/</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">|</span> <span style="color: #d3869b">0</span><span style="color: #fbf1c7">;</span> <span style="color: #928374;font-style: italic">//vertical index (which row)</span>
    <span style="color: #fbf1c7;background-color: #282828">context</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">fillRect</span><span style="color: #fbf1c7">(</span>
        <span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSize</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">j</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSize</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">j</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">cellSize</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">cellSize</span>
    <span style="color: #fbf1c7">);</span>
<span style="color: #fbf1c7">}</span>

<span style="color: #fe8019">function</span> <span style="color: #fbf1c7;background-color: #282828">fillEast</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">index</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">{</span>
    <span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">index</span> <span style="color: #fbf1c7">%</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">j</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">index</span> <span style="color: #fbf1c7">/</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">|</span> <span style="color: #d3869b">0</span><span style="color: #fbf1c7">;</span>
    <span style="color: #fbf1c7;background-color: #282828">context</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">fillRect</span><span style="color: #fbf1c7">(</span>
        <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">cellSize</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">),</span>
        <span style="color: #fbf1c7;background-color: #282828">j</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSize</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">j</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">cellSize</span>
    <span style="color: #fbf1c7">);</span>
<span style="color: #fbf1c7">}</span>

<span style="color: #fe8019">function</span> <span style="color: #fbf1c7;background-color: #282828">fillSouth</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">index</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">{</span>
    <span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">index</span> <span style="color: #fbf1c7">%</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">j</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">index</span> <span style="color: #fbf1c7">/</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">|</span> <span style="color: #d3869b">0</span><span style="color: #fbf1c7">;</span>
    <span style="color: #fbf1c7;background-color: #282828">context</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">fillRect</span><span style="color: #fbf1c7">(</span>
        <span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSize</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">j</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">cellSize</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span><span style="color: #fbf1c7">),</span>
        <span style="color: #fbf1c7;background-color: #282828">cellSize</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">cellSpacing</span>
    <span style="color: #fbf1c7">);</span>
<span style="color: #fbf1c7">}</span>

<span style="color: #fe8019">function</span> <span style="color: #fbf1c7;background-color: #282828">shuffle</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">array</span><span style="color: #fbf1c7">,</span> <span style="color: #fbf1c7;background-color: #282828">i0</span><span style="color: #fbf1c7">,</span> <span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">{</span>
    <span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">m</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">-</span> <span style="color: #fbf1c7;background-color: #282828">i0</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">t</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">i</span><span style="color: #fbf1c7">,</span>
        <span style="color: #fbf1c7;background-color: #282828">j</span><span style="color: #fbf1c7">;</span>
    <span style="color: #fb4934">while </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">m</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">{</span>
        <span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">Math</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">random</span><span style="color: #fbf1c7">()</span> <span style="color: #fbf1c7">*</span> <span style="color: #fbf1c7;background-color: #282828">m</span><span style="color: #fbf1c7">--</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">|</span> <span style="color: #d3869b">0</span><span style="color: #fbf1c7">;</span>
        <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">t</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">array</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">m</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7;background-color: #282828">i0</span><span style="color: #fbf1c7">]),</span>
            <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">array</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">m</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7;background-color: #282828">i0</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">array</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7;background-color: #282828">i0</span><span style="color: #fbf1c7">]),</span>
            <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">array</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7;background-color: #282828">i0</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">t</span><span style="color: #fbf1c7">);</span>
    <span style="color: #fbf1c7">}</span>
    <span style="color: #fb4934">return</span> <span style="color: #fbf1c7;background-color: #282828">array</span><span style="color: #fbf1c7">;</span>
<span style="color: #fbf1c7">}</span>
</pre>
<p>Here is the fantastic 5 helper functions! At its core, is the exploreFrontier(). So I&rsquo;ll quickly go over the other 4:</p>

<ul>
<li>  <code>fillCell()</code> - I explained this before, but it just draws a cell onto the screen.</li>
<li>  <code>fillEast()</code> and <code>fillSouth()</code> - this draws the spacings, so a rectangle of size cellSize x cellSpacing. Note that when this function is called, the color can be either white or black. It&rsquo;s white when there is a connected cell path, and black otherwise. Also, there isn&rsquo;t fillNorth() or fillWest() because you can always reuse the the existing function to achieve the same result. For example, to draw the spacing on the north side of the block, just call fillSouth() on the index that&rsquo;s above the block.</li>
<li>  <code>shuffle()</code> - This uses the &quot;Fisher-Yates shuffling algorithm&rdquo;. Mike also explains this algorithm in <a href="https://bost.ocks.org/mike/algorithms/#shuffling" target="_blank">his article</a>. What this does is shuffle the <code>m</code> top elements of the stack to add randomness. <code>m</code> is the amount of potential paths that we pushed onto the stack in the current iteration.</li>
</ul>

<h3 id="breaking-down-explorefrontier">Breaking down exploreFrontier()</h3>
<pre class="javascript"><span style="color: #fb4934">if </span><span style="color: #fbf1c7">((</span><span style="color: #fbf1c7;background-color: #282828">edge</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">pop</span><span style="color: #fbf1c7">())</span> <span style="color: #fbf1c7">==</span> <span style="color: #d3869b">null</span><span style="color: #fbf1c7">)</span> <span style="color: #fb4934">return</span> <span style="color: #d3869b">true</span><span style="color: #fbf1c7">;</span>

<span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">edge</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">i0</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">edge</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">index</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">edge</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">direction</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">=</span>
        <span style="color: #fbf1c7;background-color: #282828">i0</span> <span style="color: #fbf1c7">+</span>
        <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">===</span> <span style="color: #fbf1c7;background-color: #282828">N</span> <span style="color: #fbf1c7">?</span> <span style="color: #fbf1c7">-</span><span style="color: #fbf1c7;background-color: #282828">cellWidth</span> <span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">===</span> <span style="color: #fbf1c7;background-color: #282828">S</span> <span style="color: #fbf1c7">?</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span> <span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">===</span> <span style="color: #fbf1c7;background-color: #282828">W</span> <span style="color: #fbf1c7">?</span> <span style="color: #fbf1c7">-</span><span style="color: #d3869b">1</span> <span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7">+</span><span style="color: #d3869b">1</span><span style="color: #fbf1c7">),</span>
    <span style="color: #fbf1c7;background-color: #282828">x0</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">i0</span> <span style="color: #fbf1c7">%</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">y0</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i0</span> <span style="color: #fbf1c7">/</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">|</span> <span style="color: #d3869b">0</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">x1</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">y1</span><span style="color: #fbf1c7">,</span>
    <span style="color: #fbf1c7;background-color: #282828">d1</span><span style="color: #fbf1c7">,</span> <span style="color: #928374;font-style: italic">//direction of previous block from i1's POV</span>
    <span style="color: #fbf1c7;background-color: #282828">open</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">==</span> <span style="color: #d3869b">null</span><span style="color: #fbf1c7">;</span> <span style="color: #928374;font-style: italic">// opposite not yet part of the maze</span>
</pre>
<ul>
<li>  In the beginning, it pops an edge (this is an object {cellIndex, direction}).</li>
<li>  We initialize i0 as the old visited index (parent cell) and d0 as the direction of the new path from that cell.</li>
<li>  i1 indicates the index of the new cell to be visited. Depending on the direction d0, it will find this new cell by adding some amount to i0.</li>
<li>  x0 and y0 is the row and column index of the parent. While x1 and y1 will be for the new cell.</li>
<li>  d1 will be the direction to the parent cell from i1&rsquo;s (the new cell) point-of-view. This is opposite to d0. For example, if d0 is west, d1 will be east.</li>
<li>  open indicates if there is a valid path to the cell at i1. For example, if there already exist a cell in i1, then it&rsquo;s not a valid path.</li>
</ul>
<pre class="javascript"><span style="color: #928374;font-style: italic">//fill i1 according to d0 (this is for the spacing in between)</span>
<span style="color: #fbf1c7;background-color: #282828">context</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">fillStyle</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">open</span> <span style="color: #fbf1c7">?</span> <span style="color: #b8bb26;font-style: italic">"</span><span style="color: #b8bb26;font-style: italic">white</span><span style="color: #b8bb26;font-style: italic">"</span> <span style="color: #fbf1c7">:</span> <span style="color: #b8bb26;font-style: italic">"</span><span style="color: #b8bb26;font-style: italic">black</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #fbf1c7">;</span>
<span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">===</span> <span style="color: #fbf1c7;background-color: #282828">N</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7;background-color: #282828">fillSouth</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">x1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">x0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">y1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">y0</span> <span style="color: #fbf1c7">-</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">S</span><span style="color: #fbf1c7">);</span>
<span style="color: #fb4934">else</span> <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">===</span> <span style="color: #fbf1c7;background-color: #282828">S</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7;background-color: #282828">fillSouth</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">x1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">x0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">y1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">y0</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">N</span><span style="color: #fbf1c7">);</span>
<span style="color: #fb4934">else</span> <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d0</span> <span style="color: #fbf1c7">===</span> <span style="color: #fbf1c7;background-color: #282828">W</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7;background-color: #282828">fillEast</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">x1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">x0</span> <span style="color: #fbf1c7">-</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">y1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">y0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">E</span><span style="color: #fbf1c7">);</span>
<span style="color: #fb4934">else</span> <span style="color: #fbf1c7;background-color: #282828">fillEast</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">x1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">x0</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">y1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">y0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">d1</span> <span style="color: #fbf1c7">=</span> <span style="color: #fbf1c7;background-color: #282828">W</span><span style="color: #fbf1c7">);</span>
</pre>
<ul>
<li>  This section colors the spacing between the parent cell to cell at i1. Based on whether i1 is an open/valid path, it would color the spacing either black/white.</li>
</ul>
<pre class="javascript"><span style="color: #928374;font-style: italic">//fill cell and fill magenta fontier (if open)</span>
<span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">open</span><span style="color: #fbf1c7">)</span> <span style="color: #fbf1c7">{</span>
    <span style="color: #fbf1c7;background-color: #282828">fillCell</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">);</span>
    <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i0</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">|=</span> <span style="color: #fbf1c7;background-color: #282828">d0</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">|=</span> <span style="color: #fbf1c7;background-color: #282828">d1</span><span style="color: #fbf1c7">);</span> <span style="color: #928374;font-style: italic">//set 4-bit direction</span>
    <span style="color: #fbf1c7;background-color: #282828">context</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">fillStyle</span> <span style="color: #fbf1c7">=</span> <span style="color: #b8bb26;font-style: italic">"</span><span style="color: #b8bb26;font-style: italic">magenta</span><span style="color: #b8bb26;font-style: italic">"</span><span style="color: #fbf1c7">;</span>

    <span style="color: #fe8019">var</span> <span style="color: #fbf1c7;background-color: #282828">m</span> <span style="color: #fbf1c7">=</span> <span style="color: #d3869b">0</span><span style="color: #fbf1c7">;</span>
    <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">y1</span> <span style="color: #fbf1c7">&gt;</span> <span style="color: #d3869b">0</span> <span style="color: #fbf1c7">&amp;&amp;</span> <span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">-</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">==</span> <span style="color: #d3869b">null</span><span style="color: #fbf1c7">)</span>
        <span style="color: #fbf1c7;background-color: #282828">fillSouth</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">-</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">),</span>
            <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">push</span><span style="color: #fbf1c7">({</span> <span style="color: #b8bb26">index</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">,</span> <span style="color: #b8bb26">direction</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">N</span> <span style="color: #fbf1c7">}),</span>
            <span style="color: #fbf1c7">++</span><span style="color: #fbf1c7;background-color: #282828">m</span><span style="color: #fbf1c7">;</span>
    <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">y1</span> <span style="color: #fbf1c7">&lt;</span> <span style="color: #fbf1c7;background-color: #282828">cellHeight</span> <span style="color: #fbf1c7">-</span> <span style="color: #d3869b">1</span> <span style="color: #fbf1c7">&amp;&amp;</span> <span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">+</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">==</span> <span style="color: #d3869b">null</span><span style="color: #fbf1c7">)</span>
        <span style="color: #fbf1c7;background-color: #282828">fillSouth</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">push</span><span style="color: #fbf1c7">({</span> <span style="color: #b8bb26">index</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">,</span> <span style="color: #b8bb26">direction</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">S</span> <span style="color: #fbf1c7">}),</span> <span style="color: #fbf1c7">++</span><span style="color: #fbf1c7;background-color: #282828">m</span><span style="color: #fbf1c7">;</span>
    <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">x1</span> <span style="color: #fbf1c7">&gt;</span> <span style="color: #d3869b">0</span> <span style="color: #fbf1c7">&amp;&amp;</span> <span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">-</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">==</span> <span style="color: #d3869b">null</span><span style="color: #fbf1c7">)</span>
        <span style="color: #fbf1c7;background-color: #282828">fillEast</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">-</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">push</span><span style="color: #fbf1c7">({</span> <span style="color: #b8bb26">index</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">,</span> <span style="color: #b8bb26">direction</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">W</span> <span style="color: #fbf1c7">}),</span> <span style="color: #fbf1c7">++</span><span style="color: #fbf1c7;background-color: #282828">m</span><span style="color: #fbf1c7">;</span>
    <span style="color: #fb4934">if </span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">x1</span> <span style="color: #fbf1c7">&lt;</span> <span style="color: #fbf1c7;background-color: #282828">cellWidth</span> <span style="color: #fbf1c7">-</span> <span style="color: #d3869b">1</span> <span style="color: #fbf1c7">&amp;&amp;</span> <span style="color: #fbf1c7;background-color: #282828">cells</span><span style="color: #fbf1c7">[</span><span style="color: #fbf1c7;background-color: #282828">i1</span> <span style="color: #fbf1c7">+</span> <span style="color: #d3869b">1</span><span style="color: #fbf1c7">]</span> <span style="color: #fbf1c7">==</span> <span style="color: #d3869b">null</span><span style="color: #fbf1c7">)</span>
        <span style="color: #fbf1c7;background-color: #282828">fillEast</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">),</span> <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">push</span><span style="color: #fbf1c7">({</span> <span style="color: #b8bb26">index</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">i1</span><span style="color: #fbf1c7">,</span> <span style="color: #b8bb26">direction</span><span style="color: #fbf1c7">:</span> <span style="color: #fbf1c7;background-color: #282828">E</span> <span style="color: #fbf1c7">}),</span> <span style="color: #fbf1c7">++</span><span style="color: #fbf1c7;background-color: #282828">m</span><span style="color: #fbf1c7">;</span>
    <span style="color: #fbf1c7;background-color: #282828">shuffle</span><span style="color: #fbf1c7">(</span><span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">,</span> <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">length</span> <span style="color: #fbf1c7">-</span> <span style="color: #fbf1c7;background-color: #282828">m</span><span style="color: #fbf1c7">,</span> <span style="color: #fbf1c7;background-color: #282828">frontier</span><span style="color: #fbf1c7">.</span><span style="color: #fbf1c7;background-color: #282828">length</span><span style="color: #fbf1c7">);</span>
<span style="color: #fbf1c7">}</span>
</pre>
<ul>
<li>  If i1 is a open path, then <code>fillCell(i1)</code> is called to draw the white cell.</li>
<li>  Then we use bitwise OR to update the 4 bit stored in <code>cell[]</code> at index i0 and i1, to mark the new connected path between them.</li>
<li>  We now check all frontiers (4 directions) to see if it is a valid path (condition: i1 is within the canvas and doesn&rsquo;t contain an existing cell). If it is a possible path, color the spacing with a magenta color.</li>
<li>  <code>m</code> counts the number of valid frontiers added on the stack. This is used to then shuffle the <code>m</code> top elements on the stack, so the maze will randomly move in any of those <code>m</code> directions in the next iteration.</li>
</ul>

<p>Here is an example if I removed <code>shuffle()</code>. It would just pop the last added item, and the maze becomes&hellip; predictable.</p>

<center>
    <Canvas id="noShuffle"></Canvas>
</center>

<h2 id="thoughts">Thoughts</h2>

<p>This DFS algorithm is quite simple. There is only a single head and we choose the next path from the most recently added item in the <code>frontier[]</code> array using a stack.</p>

<p>Even with this, there are so much variations of this algorithm. For example, if instead of shuffling the <code>m</code> top most items, we shuffle all items; then the maze traverse from all possible paths like a sweep across the canvas.</p>

<h2 id="what-i-learned">What I learned</h2>

<p>I honestly didn&rsquo;t expect the implementation to be this straight-forward. Of course, I&rsquo;m just reading this code and I imagine designing this visualization in and on itself can be quite difficult.</p>

<p>But aside from rendering the rectangles and the timer API, most of it is just plain Javascript! I&rsquo;ve heard a lot about the steep learning curve of D3, but it seems like you don&rsquo;t have to be super familiar with D3 to create stunning visualizations like this. I found that 90% of the complexity was probably on the algorithm itself, and D3 provides a pretty lightweight solution for displaying this on HTML5 canvas.</p>

<p>I&rsquo;m not undermining the difficulty of D3 because I have little clue at this point on the full capabilities of D3. But I&rsquo;m confident to say that the barrier to entry isn&rsquo;t that rough. You can make great visualizations by utilizing just the basics. Just start with a rect.</p>

<h2 id="difficulties-with-client-side-js">Difficulties with Client-side JS</h2>

<p>I spent a lot of time trying to figure out how to display D3 and Canvas on this next-MDX post. I used a simple <code>&lt;script&gt;</code> tag to load the code but it only works on SSR.</p>

<p>If you load this page with Next/Link I think it would bundle things and the page wouldn&rsquo;t recognize the D3 code imported from the <code>&lt;script&gt;</code> tag.</p>

<p>I wish there was a better way to import this client-side js asset and have it run with Next. But at this point Next&rsquo;s prefetching, window.onLoad(), and bundling is still all alien :alien: to me.</p>

<p>In the end I was still not successful. So as you can see, the maze simulations only appears after a full reload (SSR). Please do reach out to me if you have any clue.</p>

  </main>
  <div class="my-10">
    <button id="js-discuss-button" class="rounded-2xl border-2 border-slate-400 md:w-auto w-full px-5 py-4 hover:font-semibold">Show comments</button>
<div id="disqus_thread"></div>
<script>
  var commentButton = document.getElementById("js-discuss-button")
  var disqus_config = function () {
    this.page.url = `https://stevenwhat.me/blog/archived/code-brakedown-maze-generator`;
    this.page.identifier = "/blog/archived/code_brakedown_maze_generator";
    this.page.title = "Code Breakdown - Maze Generator (by Mike Bostock)";
  };
  commentButton.addEventListener('click', function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://blog-zlm7tpahgt.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);

    event.target.parentElement.removeChild(event.target);
  })
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  </div>

    </div>
    <div data-controller="subscription" class="flex flex-col items-center p-8 bg-slate-50 dark:bg-slate-800 dark:shadow-slate-700 shadow-lg">
  <p class="text-xl">Get my latest articles and updates</p>
  <p>At most one email a month and no spam.</p>

  <div class="mt-5 flex">
    <label class="items-center">
      <input type="email" data-subscription-target="email" class="w-full rounded-xl dark:bg-zinc-700" placeholder="Your email" required>
    </label>
    <button type="submit" data-action="click->subscription#submitForm" class="px-3 ml-2 ext-white bg-blue-500 rounded-lg">
      Subscribe
    </button>
  </div>
</div>

    <footer class="">
      <div class="text-center text-xs">Â© Steven 2019</div>
    </footer>
  </div>

  </body>
</html>
